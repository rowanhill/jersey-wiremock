<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Jersey-wiremock by rowanhill</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Jersey-wiremock</h1>
      <h2 class="project-tagline">Easily create simple WireMock stubbers/verifiers based on Jersey resources</h2>
      <a href="https://github.com/rowanhill/jersey-wiremock" class="btn">View on GitHub</a>
      <a href="https://github.com/rowanhill/jersey-wiremock/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/rowanhill/jersey-wiremock/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="jersey-wiremock" class="anchor" href="#jersey-wiremock" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>jersey-wiremock</h1>

<p>Autogenerated stubbing &amp; verifying of Jersey resources with WireMock</p>

<h2>
<a id="what-is-it" class="anchor" href="#what-is-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is it?</h2>

<p>Jersey (particularly as part of Dropwizard) is great for developing HTTP APIs, using declarative annotations to define
behaviour.</p>

<p>WireMock is great at mocking out HTTP APIs when writing integration tests.</p>

<p>With jersey-wiremock, you can create classes which encapsulate the logic of mocking out your resources (e.g. building
paths, adding query parameters, serialising response entities) without having to write all the boilerplate.</p>

<h2>
<a id="show-me-an-example" class="anchor" href="#show-me-an-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Show me an example</h2>

<p>Let's say you have the following resource:</p>

<div class="highlight highlight-source-java"><pre>@Path(<span class="pl-s"><span class="pl-pds">"</span>/cakes<span class="pl-pds">"</span></span>)
@Produces(<span class="pl-smi">MediaType</span><span class="pl-c1"><span class="pl-k">.</span>APPLICATION_JSON</span>)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">CakesResource</span> {
    <span class="pl-k">@GET</span>
    <span class="pl-k">public</span> <span class="pl-k">List&lt;<span class="pl-smi">Cake</span>&gt;</span> <span class="pl-en">getAllCakesByFlavour</span>(<span class="pl-k">@QueryParam</span>(<span class="pl-s"><span class="pl-pds">"</span>flavour<span class="pl-pds">"</span></span>) <span class="pl-smi">CakeFlavour</span> <span class="pl-v">flavour</span>) {
        <span class="pl-c">// ... retrieve all cakes with given flavour from data store and return result</span>
    }

    <span class="pl-k">@POST</span>
    <span class="pl-k">public</span> <span class="pl-k">long</span> <span class="pl-en">addNewCake</span>(<span class="pl-smi">Cake</span> <span class="pl-v">cake</span>) {
        <span class="pl-c">// ... add cake to data store and return assigned id ...</span>
    }
}</pre></div>

<p>Using jersey-wiremock, you can define a mocker like this:</p>

<div class="highlight highlight-source-java"><pre>@WireMockForResource(<span class="pl-smi">CakesResource</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">CakesMocker</span> {
    <span class="pl-k">@WireMockStub</span>(<span class="pl-s"><span class="pl-pds">"</span>getAllCakesByFlavour<span class="pl-pds">"</span></span>)
    <span class="pl-k">GetListRequestStubber&lt;<span class="pl-smi">Cake</span>&gt;</span> <span class="pl-en">stubGetAllCakesByFlavour</span>(<span class="pl-smi">CakeFlavour</span> <span class="pl-v">flavour</span>);
    <span class="pl-k">@WireMockVerify</span>(<span class="pl-s"><span class="pl-pds">"</span>getAllCakesByFlavour<span class="pl-pds">"</span></span>)
    <span class="pl-smi">GetRequestVerifier</span> <span class="pl-en">verifyGetAllCakesByFlavour</span>(<span class="pl-smi">CakeFlavour</span> <span class="pl-v">flavour</span>);

    <span class="pl-k">@WireMockStub</span>(<span class="pl-s"><span class="pl-pds">"</span>addNewCake<span class="pl-pds">"</span></span>)
    <span class="pl-k">PostRequestVerifier&lt;<span class="pl-smi">Void</span>&gt;</span> <span class="pl-en">stubAddCake</span>();
}</pre></div>

<p>Which you can then use in your tests like this:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">OtherServiceIntegrationTest</span> {
    <span class="pl-c">// ... set up an OtherService instance somehow - perhaps via DropwizardAppRule ...</span>

    <span class="pl-k">@Rule</span>
    <span class="pl-k">public</span> <span class="pl-smi">WireMockRule</span> wireMockRule <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">WireMockRule</span>(<span class="pl-c1">8080</span>);

    <span class="pl-k">private</span> <span class="pl-smi">CakesMocker</span> cakesMocker;

    <span class="pl-k">@Before</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setUp</span>() {
        <span class="pl-smi">ObjectMapper</span> objectMapper <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ObjectMapper</span>();
        cakesMocker <span class="pl-k">=</span> <span class="pl-smi">MockerFactory</span><span class="pl-k">.</span>wireMockerFor(
            <span class="pl-smi">CakesMocker</span><span class="pl-k">.</span>class, wireMockRule, objectMapper);
    }

    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">otherServiceRequestsCakesByFlavourExactlyOnce</span>() {
        <span class="pl-c">// given</span>
        <span class="pl-smi">CakeFlavour</span> flavour <span class="pl-k">=</span> <span class="pl-smi">CakeFlavour</span><span class="pl-c1"><span class="pl-k">.</span>CHOCOLATE</span>;
        cakesMocker<span class="pl-k">.</span>stubGetAllCakesByFlavour(flavour)
            .andRespondWith(<span class="pl-k">new</span> <span class="pl-smi">Cake</span>(<span class="pl-c1">1</span>, flavour, <span class="pl-s"><span class="pl-pds">"</span>Test recipe<span class="pl-pds">"</span></span>))<span class="pl-k">.</span>stub();

        <span class="pl-c">// when</span>
        <span class="pl-c">// ... invoke something on OtherService instance ...</span>

        <span class="pl-c">// then</span>
        <span class="pl-c">// ... maybe make some assertions ...</span>
        cakesMocker<span class="pl-k">.</span>verifyGetAllCakesbyFlavour(flavour)<span class="pl-k">.</span>times(<span class="pl-c1">1</span>)<span class="pl-k">.</span>verify();
    }

    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">otherServiceHandlesErrorWhenCreatingCake</span>() {
        <span class="pl-c">// given</span>
        cakesMocker<span class="pl-k">.</span>stubAddCake()
                .withRequestBody(matchingJsonPath(
                    <span class="pl-s"><span class="pl-pds">"</span>$..[?(@.status=='<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">CakeFlavour</span><span class="pl-c1"><span class="pl-k">.</span>LEMON</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>')]<span class="pl-pds">"</span></span>
                ))
                .andRespond()<span class="pl-k">.</span>withStatusCode(<span class="pl-c1">500</span>)<span class="pl-k">.</span>stub();

        <span class="pl-c">// when</span>
        <span class="pl-c">// ... invoke something on OtherService instance that creates a lemon cake ...</span>

        <span class="pl-c">// then</span>
        <span class="pl-c">// ... assert that OtherService gracefully handled a 500 ...</span>
    }
}</pre></div>

<h2>
<a id="tell-me-more---what-can-it-do" class="anchor" href="#tell-me-more---what-can-it-do" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tell me more - what can it do?</h2>

<h3>
<a id="supported-operations" class="anchor" href="#supported-operations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Supported operations</h3>

<p>You can both stub and verify <a href="https://github.com/GET" class="user-mention">@GET</a>, <a href="https://github.com/POST" class="user-mention">@POST</a>, <a href="https://github.com/PUT" class="user-mention">@PUT</a> and <a href="https://github.com/DELETE" class="user-mention">@DELETE</a> requests, using functionality automatically generated from
simple interface definitions.</p>

<table>
<thead>
<tr>
<th>Request type</th>
<th>Action</th>
<th>Interface method return type</th>
<th>Interface method annotation</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>@GET</code> (singular return type)</td>
<td>Stub</td>
<td><code>GetSingleRequestStubber&lt;EntityType&gt;</code></td>
<td><code>@WireMockStub</code></td>
</tr>
<tr>
<td>
<code>@GET</code> (collection return type)</td>
<td>Stub</td>
<td><code>GetListRequestStubber&lt;CollectionEntityType&gt;</code></td>
<td><code>@WireMockStub</code></td>
</tr>
<tr>
<td>
<code>@GET</code> (all types)</td>
<td>Verify</td>
<td><code>GetRequestVerifier</code></td>
<td><code>@WireMockVerify</code></td>
</tr>
<tr>
<td><code>@POST</code></td>
<td>Stub</td>
<td><code>PostRequestStubber&lt;RequestEntity, ResponseEntity&gt;</code></td>
<td><code>@WireMockStub</code></td>
</tr>
<tr>
<td><code>@POST</code></td>
<td>Verify</td>
<td><code>PostRequestVerifier&lt;RequestEntity&gt;</code></td>
<td><code>@WireMockVerify</code></td>
</tr>
<tr>
<td><code>@PUT</code></td>
<td>Stub</td>
<td><code>PutRequestStubber&lt;RequestEntity, ResponseEntity&gt;</code></td>
<td><code>@WireMockStub</code></td>
</tr>
<tr>
<td><code>@PUT</code></td>
<td>Verify</td>
<td><code>GutRequestVerifier&lt;RequestEntity&gt;</code></td>
<td><code>@WireMockVerify</code></td>
</tr>
<tr>
<td><code>@DELETE</code></td>
<td>Stub</td>
<td><code>DeleteRequestStubber&lt;ResponseEntity&gt;</code></td>
<td><code>@WireMockStub</code></td>
</tr>
<tr>
<td><code>@DELETE</code></td>
<td>Verify</td>
<td><code>DeleteRequestVerifier</code></td>
<td><code>@WireMockVerify</code></td>
</tr>
</tbody>
</table>

<h3>
<a id="argument-handling" class="anchor" href="#argument-handling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Argument handling</h3>

<h4>
<a id="argument-resolution" class="anchor" href="#argument-resolution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Argument resolution</h4>

<p>Arguments to mocker methods are matched up to the arguments of resource methods in one of two ways: either explicitly,
using <code>@ParamNamed</code> on every mocker method argument, or implicitly, with no arguments annotated with <code>@ParamNamed</code>.</p>

<p>When resolving arguments explicitly, the mocker method must have an argument for every <code>@PathParam</code> declared by the
resource method, but <code>@QueryParam</code> arguments are optional. Ordering or arguments can be arbitrary.</p>

<p>When resolving arguments implicitly, the mocker interface methods must have an argument for each <code>@PathParam</code> and
<code>@QueryParam</code> declared by the resource method, and they must be declared in the same order.</p>

<p>No other parameters (e.g. <code>@Context</code>, entity parameters) should be declared in the mocker method; <code>@HeaderParam</code> is
not supported.</p>

<h4>
<a id="argument-serialisation" class="anchor" href="#argument-serialisation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Argument serialisation</h4>

<p>If an argument needs more careful serialisation than simply calling toString() on it, apply the <code>@ParamFormat</code>
annotation to specify a <code>ParamFormatter</code> class to perform the formatting. You can do this on either the <em>resource</em>
method argument (if you want to set a default serialiser that all mocker methods will use), or on the <em>mocker</em> method
argument (if you want to override a deafult, or if you don't want or are unable to modify the resource class).</p>

<h4>
<a id="query-parameter-matching" class="anchor" href="#query-parameter-matching" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Query parameter matching</h4>

<p>By default, query parameters are matched using WireMock's <code>equalTo()</code> value matching strategy. To use a different
strategy annotate the <em>mocker</em> method parameter with <code>@ParamMatchedBy</code>. Supported strategies are <code>EQUAL_TO</code>,
<code>CONTAINING</code>, <code>MATCHING</code> and <code>NOT_MATCHING</code>.</p>

<p>Note that <code>@ParamMatchedBy</code> has no effect on path parameters.</p>

<h3>
<a id="request-body-matching" class="anchor" href="#request-body-matching" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request body matching</h3>

<p>Request stubbers and verifiers for request types that have request entity bodies come with two methods for matching
those request bodies: <code>withRequestEntity(T entity)</code> and <code>withRequestBody(ValueMatchingStrategy strategy)</code>. The first is
will take an entity and serialise it with the ObjectMapper to provide the string to match against. The second allows
much more fine-grained control over the matching, by allowing specification of any WireMock <code>ValueMatchingStrategy</code>,
e.g. <code>contains()</code> or <code>matchesJsonPath()</code>.</p>

<p>If no request body matching is specified, any request body is acceptable.</p>

<h3>
<a id="response-body-writing" class="anchor" href="#response-body-writing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response body writing</h3>

<p>Request stubbers for request types that have singular response bodies can specify a response to reply with - to do so,
use either the <code>.andRespondWith(myEntity)</code> or <code>.andRespond().withEntity(myEntity)</code> forms. The given object will be
serialised with the ObjectMapper and returned.</p>

<p>For collection type responses, usage is very similar: <code>.andRespondWith(entity1, entity2, ...)</code> or
<code>.andRespond().withEntities(entity1, entity2)</code>. All entities will be placed in an empty collection of the appropriate
type, then that collection will be serialised.</p>

<h3>
<a id="simulating-faults" class="anchor" href="#simulating-faults" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simulating faults</h3>

<p>WireMock faults can be applied to responses, e.g. <code>.andRespond().withFault(Fault.EMPTY_RESPONSE)</code>.</p>

<h2>
<a id="but-it-doesnt-do-x" class="anchor" href="#but-it-doesnt-do-x" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>But it doesn't do X!</h2>

<p>The aim is only to handle the simple cases. For more complicated cases, it's still possible to retain some benefits
from jersey-wiremock by using an abstract class instead of an interface. All the annotated abstract methods work as
described above, but concrete methods may be provided to perform actions that jersey-wiremock doesn't support.</p>

<p>All such abstract classes must inherit from <code>BaseMocker</code>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/rowanhill/jersey-wiremock">Jersey-wiremock</a> is maintained by <a href="https://github.com/rowanhill">rowanhill</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
